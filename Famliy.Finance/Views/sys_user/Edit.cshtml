@model Famliy.Finance.Models.sys_user
@using Famliy.Finance.Models
@{
    ViewBag.Title = "用户管理：编辑";
    var RoleList=ViewBag.RoleList as List<sys_role>;
    var UserRoleList =ViewBag.UserRoleList as List<sys_user_role>;
}
<style type="text/css">
    select[multiple], select[size] {
        height: 225px;
    }

    .demo {
        width: 450px;
        margin: 100px auto;
    }

    .select_side {
        float: left;
        /*width: 220px;*/
    }

    .selectL {
        width: 200px;
        height: 220px;
    }

    .select_opt {
        padding: 0 10px 0 10px;
        float: left;
        width: 60px;
        height: 100%;
        margin-top: 36px;
    }

        .select_opt p {
            width: 26px;
            height: 26px;
            margin-top: 6px;
            background: url(arr.gif) no-repeat;
            cursor: pointer;
            text-indent: -999em;
        }

            .select_opt p#toright {
                background-position: 2px 0;
            }

            .select_opt p#toleft {
                background-position: 2px -22px;
            }

    .sub_btn {
        clear: both;
        height: 42px;
        line-height: 42px;
        padding-top: 10px;
        text-align: left;
    }
</style>
<div class="row">
    <div class="col-lg-12 col-sm-12 col-xs-12" style="padding-left:30px;">
        <h5 class="row-title before-palegreen"><i class="fa fa-columns palegreen"></i>@Html.ActionLink("返回列表", "Index")</h5>
    </div>
    <div  class="row">
        <div class="col-md-6">
            <div class="well with-header">
                <div class="header bordered-sky">
                    编辑家庭用户
                </div>

                @using (Html.BeginForm())
            {
                    @Html.AntiForgeryToken()
                    <div class="form-horizontal">
                        <div class="col-md-offset-2 col-md-10">
                            <div class="alert-danger">@Html.ValidationSummary() </div>
                        </div>
                        @Html.HiddenFor(model => model.user_id)


                        <div class="form-group">
                            @Html.LabelFor(model => model.user_name, htmlAttributes: new { @class = "control-label col-md-2" })
                            <div class="col-md-10">
                                @*@Html.DisplayFor(model => model.user_name, new { htmlAttributes = new { @class = "form-control" } })*@
                                @Html.EditorFor(model => model.user_name, new { htmlAttributes = new { @class = "form-control" ,@readonly="readonly"} })
                                @Html.ValidationMessageFor(model => model.user_name, "", new { @class = "text-danger" })
                            </div>
                        </div>

                        <div class="form-group">
                            @Html.LabelFor(model => model.password, htmlAttributes: new { @class = "control-label col-md-2" })
                            <div class="col-md-10">
                                @Html.EditorFor(model => model.password, new { htmlAttributes = new { @class = "form-control" } })
                                @Html.ValidationMessageFor(model => model.password, "", new { @class = "text-danger" })
                            </div>
                        </div>

                        <div class="form-group">
                            @Html.LabelFor(model => model.nick_name, htmlAttributes: new { @class = "control-label col-md-2" })
                            <div class="col-md-10">
                                @Html.EditorFor(model => model.nick_name, new { htmlAttributes = new { @class = "form-control" } })
                                @Html.ValidationMessageFor(model => model.nick_name, "", new { @class = "text-danger" })
                            </div>
                        </div>

                        <div class="form-group">
                            <label class="control-label col-md-2">属于的家庭</label>
                            <div class="col-md-10">
                                @Html.DropDownListFor(model => model.family_id, ViewData["FamilyList"] as IEnumerable<SelectListItem>, new { htmlAttributes = new { @class = "form-control" } })
                                @Html.ValidationMessageFor(model => model.family_id, "", new { @class = "text-danger" })
                            </div>
                        </div>
                        <div class="form-group">
                            @Html.LabelFor(model => model.family_name, htmlAttributes: new { @class = "control-label col-md-2" })
                            <div class="col-md-10">
                                @Html.EditorFor(model => model.family_name, new { htmlAttributes = new { @class = "form-control" } })
                                @Html.ValidationMessageFor(model => model.family_name, "", new { @class = "text-danger" })
                            </div>
                        </div>

                        <div class="form-group">
                            @Html.LabelFor(model => model.remark, htmlAttributes: new { @class = "control-label col-md-2" })
                            <div class="col-md-10">
                                @Html.EditorFor(model => model.remark, new { htmlAttributes = new { @class = "form-control" } })
                                @Html.ValidationMessageFor(model => model.remark, "", new { @class = "text-danger" })
                            </div>
                        </div>

                        <div class="form-group">
                            @Html.LabelFor(model => model.sex, htmlAttributes: new { @class = "control-label col-md-2" })
                            <div class="col-md-10">
                                <div class="checkbox">
                                    @*@Html.EditorFor(model => model.sex)*@
                                    @Html.DropDownListFor(model => model.sex,new SelectListItem[]{
                               new SelectListItem{ Text="男",Value="true", Selected=true},
                               new SelectListItem{Text="女",Value="false"}
                           })
                                    @Html.ValidationMessageFor(model => model.sex, "", new { @class = "text-danger" })
                                </div>
                            </div>
                        </div>

                        <div class="form-group">
                            @Html.LabelFor(model => model.age, htmlAttributes: new { @class = "control-label col-md-2" })
                            <div class="col-md-10">
                                @Html.EditorFor(model => model.age, new { htmlAttributes = new { @class = "form-control" } })
                                @Html.ValidationMessageFor(model => model.age, "", new { @class = "text-danger" })
                            </div>
                        </div>

                        <div class="form-group">
                            @Html.LabelFor(model => model.birthday, htmlAttributes: new { @class = "control-label col-md-2" })
                            <div class="col-md-10">
                                @Html.EditorFor(model => model.birthday, new { htmlAttributes = new { @class = "form-control" } })
                                @Html.ValidationMessageFor(model => model.birthday, "", new { @class = "text-danger" })
                            </div>
                        </div>

                        <div class="form-group">
                            @Html.LabelFor(model => model.address, htmlAttributes: new { @class = "control-label col-md-2" })
                            <div class="col-md-10">
                                @Html.EditorFor(model => model.address, new { htmlAttributes = new { @class = "form-control" } })
                                @Html.ValidationMessageFor(model => model.address, "", new { @class = "text-danger" })
                            </div>
                        </div>

                        <div class="form-group">
                            @Html.LabelFor(model => model.post, htmlAttributes: new { @class = "control-label col-md-2" })
                            <div class="col-md-10">
                                @Html.EditorFor(model => model.post, new { htmlAttributes = new { @class = "form-control" } })
                                @Html.ValidationMessageFor(model => model.post, "", new { @class = "text-danger" })
                            </div>
                        </div>

                        <div class="form-group">
                            @Html.LabelFor(model => model.phone, htmlAttributes: new { @class = "control-label col-md-2" })
                            <div class="col-md-10">
                                @Html.EditorFor(model => model.phone, new { htmlAttributes = new { @class = "form-control" } })
                                @Html.ValidationMessageFor(model => model.phone, "", new { @class = "text-danger" })
                            </div>
                        </div>

                        <div class="form-group">
                            @Html.LabelFor(model => model.email, htmlAttributes: new { @class = "control-label col-md-2" })
                            <div class="col-md-10">
                                @Html.EditorFor(model => model.email, new { htmlAttributes = new { @class = "form-control" } })
                                @Html.ValidationMessageFor(model => model.email, "", new { @class = "text-danger" })
                            </div>
                        </div>

                        <div class="form-group">
                            @Html.LabelFor(model => model.qq, htmlAttributes: new { @class = "control-label col-md-2" })
                            <div class="col-md-10">
                                @Html.EditorFor(model => model.qq, new { htmlAttributes = new { @class = "form-control" } })
                                @Html.ValidationMessageFor(model => model.qq, "", new { @class = "text-danger" })
                            </div>
                        </div>

                        <div class="form-group">
                            @Html.LabelFor(model => model.weixin, htmlAttributes: new { @class = "control-label col-md-2" })
                            <div class="col-md-10">
                                @Html.EditorFor(model => model.weixin, new { htmlAttributes = new { @class = "form-control" } })
                                @Html.ValidationMessageFor(model => model.weixin, "", new { @class = "text-danger" })
                            </div>
                        </div>

                        <div class="form-group">
                            @Html.LabelFor(model => model.interest, htmlAttributes: new { @class = "control-label col-md-2" })
                            <div class="col-md-10">
                                @Html.EditorFor(model => model.interest, new { htmlAttributes = new { @class = "form-control" } })
                                @Html.ValidationMessageFor(model => model.interest, "", new { @class = "text-danger" })
                            </div>
                        </div>

                        <div class="form-group">
                            @Html.LabelFor(model => model.user_desc, htmlAttributes: new { @class = "control-label col-md-2" })
                            <div class="col-md-10">
                                @Html.EditorFor(model => model.user_desc, new { htmlAttributes = new { @class = "form-control", @rows = "3" } })
                                @Html.ValidationMessageFor(model => model.user_desc, "", new { @class = "text-danger" })
                            </div>
                        </div>

                        <div class="form-group">
                            @Html.LabelFor(model => model.last_login_time, htmlAttributes: new { @class = "control-label col-md-2" })
                            <div class="col-md-10">
                                @Html.EditorFor(model => model.last_login_time, new { htmlAttributes = new { @class = "form-control" } })
                                @Html.ValidationMessageFor(model => model.last_login_time, "", new { @class = "text-danger" })
                            </div>
                        </div>

                        <div class="form-group">
                            @Html.LabelFor(model => model.last_login_ip, htmlAttributes: new { @class = "control-label col-md-2" })
                            <div class="col-md-10">
                                @Html.EditorFor(model => model.last_login_ip, new { htmlAttributes = new { @class = "form-control" } })
                                @Html.ValidationMessageFor(model => model.last_login_ip, "", new { @class = "text-danger" })
                            </div>
                        </div>

                        <div class="form-group">
                            @Html.LabelFor(model => model.status, htmlAttributes: new { @class = "control-label col-md-2" })
                            <div class="col-md-10">
                                @Html.EditorFor(model => model.status, new { htmlAttributes = new { @class = "form-control" } })
                                @Html.ValidationMessageFor(model => model.status, "", new { @class = "text-danger" })
                            </div>
                        </div>

                        <div class="form-group">
                            <div class="col-md-offset-2 col-md-10">
                                <input type="submit" value="保存" class="btn btn-primary" />
                            </div>
                        </div>

                    </div>
            }
            </div>
        </div>
        <div class="col-md-6">
            <div class="well with-header">
                <div class="header bordered-sky">
                    角色的权限
                </div>
                <div>
                    <div class="select_side">
                        <p>待选区</p>
                        <select id="selectL" name="selectL" class="selectL" multiple="multiple">
                            @foreach (var item in RoleList)
                        {
                                <option value="@item.role_id">@item.role_name</option>
                        }
                        </select>
                    </div>
                    <div class="select_opt">
                        <a class="btn btn-default btn-lg shiny icon-only blue" href="javascript:void(0);" id="toright" title="添加"><i class="fa fa-toggle-right"></i></a>
                        <a class="btn btn-default btn-lg shiny icon-only blue" href="javascript:void(0);" id="toleft" title="移除"><i class="fa fa-toggle-left"></i></a>
                    </div>
                    <div class="select_side">
                        <p>已选区</p>
                        <select id="selectR" name="selectR" class="selectL" multiple="multiple">
                            @foreach (var item in UserRoleList)
                        {
                                <option value="@item.sys_role.role_id">@item.sys_role.role_name</option>
                        }
                        </select>
                    </div>
                    <div class="sub_btn"><input type="button" id="sub" value="保存" class="btn btn-primary" /></div>
                </div>
            </div>
        </div>
    </div>
</div>

@section scripts{
    <script type="text/javascript">
$(function(){
    var leftSel = $("#selectL");
	var rightSel = $("#selectR");
	$("#toright").bind("click",function(){
		leftSel.find("option:selected").each(function(){
			$(this).remove().appendTo(rightSel);
		});
	});
	$("#toleft").bind("click",function(){
		rightSel.find("option:selected").each(function(){
			$(this).remove().appendTo(leftSel);
		});
	});
	leftSel.dblclick(function(){
		$(this).find("option:selected").each(function(){
			$(this).remove().appendTo(rightSel);
		});
	});
	rightSel.dblclick(function(){
		$(this).find("option:selected").each(function(){
			$(this).remove().appendTo(leftSel);
		});
	});
	$("#sub").click(function(){
		var selVal = [];
		rightSel.find("option").each(function(){
			selVal.push(this.value);
		});
		selVals = selVal.join(",");
		//selVals = rightSel.val();
		if(selVals==""){
			alert("没有选择任何项！");
		} else {
		    var roleid = $("#roleid").val();
		    $.get("/sys_user/save", { rid:roleid,pids: selVals }, function (data) {
		        if (data == "ok")
		            alert("保存成功");
		        else
		            alert("保存失败");
		    });
		}
	});
});
    </script>
}